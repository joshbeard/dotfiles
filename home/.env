# ===================================================================
# Common Environment Configuration
# Sourced by sh, bash and zsh
# ===================================================================

### Environment variables
export HISTFILE=~/.zsh_history
export HISTIGNORE=ls:history
export HISTSIZE=10000
export HISTTIMEFORMAT='%Y-%m-%d %T '
export SAVEHIST=10000
export EDITOR="vim"
export MANPAGER="less -X"
export PAGER="less -X"
export KEYTIMEOUT=1
export GPG_TTY=$(tty)
export VAGRANT_DEFAULT_PROVIDER=virtualbox

### Path
export PATH=$PATH:~/bin
# make less more friendly for non-text input files, see lesspipe(1)
[ -x /usr/bin/lesspipe ] && eval "$(lesspipe)"

if [ -d /opt/local/bin ]; then
  PATH="/opt/local/bin:$PATH"
fi

# Ruby
[ -d $HOME/.rbenv/ ] && eval "$(rbenv init - zsh)"
[ -d $HOME/.vm/bin ] && PATH=$PATH:$HOME/.rvm/bin

### aliases

## Common Aliases
alias less='less -X'
alias d='dirs -v; echo -n "select number: "; read newdir; cd -"$newdir"'
alias grep="grep --color=auto"
alias rm="rm -i"
alias mv="mv -i"
alias cp="cp -i"
alias cd..="cd .."
alias mkdir='mkdir -p -v'
alias ll="ls -hl"
alias lsd="ls -hdlf */"
alias df='df -h'
alias du='du -h -c'

alias homeshick="$HOME/.homesick/repos/homeshick/bin/homeshick"

if which tmux >>/dev/null 2>&1; then
  alias tl='tmux ls'
  alias ta='tmux attach -t'
  alias tr='tmux rename-session -t'
fi

if which bundle >>/dev/null 2>&1; then
  alias bi='bundle install'
  alias be='bundle exec'
  alias bl='bundle list'
  # Disable autocorrection for 'bundle'
  alias bundle='nocorrect bundle'
fi

## OS-specific configuration
case $(uname -s) in
  Darwin|FreeBSD)
    alias ls="ls -hFG"
    # add datetime
    alias history="history -i"

    if [ -f "/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code" ]; then
      alias code='/Applications/Visual\ Studio\ Code.app/Contents/Resources/app/bin/code'
    fi

    if [ -d "/Applications/Marked 2.app" ]; then
      alias marked='open -a marked\ 2'
    fi

    if which docker >>/dev/null 2&1; then
      alias ansible-docker='docker run --rm -v ${HOME}/.ssh/id_rsa:/home/ansible/.ssh/id_rsa -v ${PWD}:/work -w /work -it joshbeard/ansible bash'
      alias ansible-homelab='docker run --rm -v ${HOME}/.ssh/id_rsa:/home/ansible/.ssh/id_rsa -v ${PWD}:/work -w /work -it code.home.jbeard.dev:5050/homelab/platform/homelab-base/ansible-tool:latest bash'
    fi

  ;;
  Linux)
    alias ls="ls --color=always -hF"
    export MAIL=/home/josh/Mail/migadu/INBOX
    export MAILCHECK=60
  ;;
  NetBSD|OpenBSD)
    alias ls="ls -hF"
  ;;
esac

### Helper Functions

function mvr {
  oldpwd=$PWD
  cd "$1"
  find . -type d -exec mkdir -p "$2"/{} \;
  find . -type f -exec mv {} "$2"/{} \;
  cd "$oldpwd"
}

# Easily delete removed files from git index
# From: https://github.com/ariejan/
grm() {
  git status | grep "deleted:" | awk '{print $3}' | xargs git rm --ignore-unmatch
}

function notes {
  glow ~/notes/notes.md
}

# Handle the tmux integration with Mac clipboard that uses this tool.
# If the command doesn't exist (i.e. linux), exit 0 so tmux runs.
function reattach-to-user-namespace {
  if which reattach-to-user-namespace; then
    reattach-to-user-namespace $@
  else
    exit 0
  fi
}

