# ------------------------------------------------------------------------------
# Josh's .muttrc
#
# Some notes:
#   * Mutt isn't retrieving IMAP, it points to a Maildir that 'offlineimap'
#     maintains.
#   * Mutt *is* configured for SMTP.
#   * SMTP credentials are retrieved from gnome-keyring-daemon or 1password.
# ------------------------------------------------------------------------------
set from = "josh@joshbeard.me"
set realname = "Josh Beard"
set use_from = yes

# Retrieve from 1password
# NOTE: This will prompt for the 1password master password each time mutt is
# opened. I launch mutt in a tmux session to persist the password in a session.
# 1password must be running for this to work.
set smtp_pass = `op item get "Migadu Mail - josh@joshbeard.me" --fields type=concealed --format json | jq -r '.value'`
set smtp_url = `op item get "Migadu Mail - josh@joshbeard.me" --fields smtp_url`

# SMTP credentials are stored in gnome-keyring-daemon.
# The 'gnome-keyring-query' tool or similar was used to populate these
# values. Example:
#   $ gnome-keyring-query set mail:password
#   $ gnome-keyring-query set mail:smtp_url

# Retrieve from gnome-keyring
#set smtp_pass = `gnome-keyring-query get mail:password`
#set smtp_url = `gnome-keyring-query get mail:smtp_url`

#set imap_check_subscribed
#unset imap_passive
#set imap_keepalive = 300

set ssl_force_tls = yes
set mail_check = 60
set mbox_type = Maildir
set folder = ~/Mail
set spoolfile = ~/Mail/INBOX
set postponed = ~/Mail/Drafts
set record = ~/Mail/Sent

set header_cache = ~/Mail/cache/headers
set message_cachedir = ~/.cache/mutt
set mailcap_path = ~/.mailcap
set tmpdir = ~/.tmp
set trash=+"Trash"

#set alias_file = ~/.mutt/aliases
#set alias_format = "%4n %t %-20a %r"

# Basic Options --------------------------------------
unset wait_key
set timeout = 3
set sendmail_wait = 0
set text_flowed = yes
unset move
set delete
unset confirmappend
set quit
unset mark_old
set beep_new
set pipe_decode
set thorough_search
set mime_forward = yes

# Sidebar Patch --------------------------------------
#set sidebar_delim = ' || '
set sidebar_visible = yes
set sidebar_width = 20
color sidebar_new yellow default
color sidebar_indicator black yellow
bind index,pager <up> sidebar-prev
bind index,pager <down> sidebar-next
bind index,pager K sidebar-prev
bind index,pager J sidebar-next
bind index,pager <right> sidebar-open
macro index,pager B '<enter-command>toggle sidebar_visible<enter>'

# Status Bar -----------------------------------------
set status_chars = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Header Options -------------------------------------
ignore *
unignore from: to: cc: date: subject:
unhdr_order *
hdr_order from: to: cc: date: subject:

# Index View Options ---------------------------------
set date_format = "%m/%d/%y at %I:%M%P"
set index_format = "%3C %Z %[!%m/%d] %-17.17F %s"
set sort = threads
set sort_aux = reverse-last-date-received
set sort_re
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"
set uncollapse_jump

# Pager View Options ---------------------------------
set pager_index_lines = 10
set pager_context = 5
set pager_stop
set menu_scroll
set tilde
unset markers
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"

auto_view text/html
alternative_order text/plain text/enriched text/html

# Compose View Options -------------------------------
set envelope_from
set sig_dashes
set edit_headers
set fast_reply
#set askcc
set fcc_attach
unset mime_forward
set forward_format = "Fwd: %s"
set attribution = "On %d, %n wrote:"
set reply_to
set reverse_name
set include
set forward_quote
set editor = "nvim +:silent+/^$"

set ispell = "aspell -e -c"
set reverse_alias
set thread_received

source ~/.mutt/keybindings
source ~/.mutt/colors
# The 'mailboxes' file is generated by 'offlineimap'
source ~/.mutt/mailboxes
source ~/.mutt/notmuch
